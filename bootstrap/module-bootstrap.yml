# Bootstrap Pipeline for Terraform Modules
# Copy this to your module repo: .buildkite/pipeline.yml
#
# This tiny pipeline clones the central scripts repo and runs the full pipeline from there.
# All logic is centralized - update once, applies everywhere!

env:
  # ============================================
  # CENTRAL SCRIPTS CONFIGURATION
  # ============================================
  SCRIPTS_REPO: "git@github.com:yourorg/terraform-buildkite-scripts.git"
  SCRIPTS_VERSION: "v1.0.0"  # Pin to version tag
  
  # ============================================
  # PROJECT CONFIGURATION (customize these!)
  # ============================================
  LYNX_SERVER_URL: "https://lynx.yourcompany.com"
  LYNX_TEAM: "platform"
  LYNX_PROJECT: "my-module-name"  # <-- CHANGE THIS
  ENVIRONMENTS: "dev tst prd"
  
  # ============================================
  # VAULT CONFIGURATION
  # ============================================
  VAULT_ADDR: "https://vault.yourcompany.com"
  # VAULT_ROLE_ID and VAULT_SECRET_ID set in Buildkite pipeline settings
  # OVM_API_KEY set in Buildkite pipeline settings

steps:
  - label: ":rocket: Bootstrap Pipeline"
    commands:
      # Clone central scripts repo
      - "git clone --branch $$SCRIPTS_VERSION --depth 1 $$SCRIPTS_REPO .buildkite-scripts"
      
      # Upload the full pipeline (replaces this bootstrap)
      - "buildkite-agent pipeline upload .buildkite-scripts/pipelines/terraform-module.yml"
    agents:
      queue: "terraform"
